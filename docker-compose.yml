services:
  # 1. FastAPI (バックエンド) サービス
  backend:
    build: ./backend                 # ./backend/Dockerfile を使用してビルド
    ports:
      - "8001:8000"                  # ホストの 8000 番ポートにマッピング
    volumes:
      # ソースコードのホットリロードマウント
      - ./backend:/app
      # FastAPIの開発サーバーを起動し、コード変更時に自動リロードする
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # 2. React (フロントエンド) サービス
  frontend:
    build: ./frontend                # ./frontend/Dockerfile を使用してビルド
    ports:
      - "5174:5173"                  # ホストの 5173 番ポートにマッピング
    environment:
      # ホストのブラウザからアクセスする場合は localhost を使用
      VITE_API_BASE_URL: http://localhost:8001
    volumes:
      # ソースコードのホットリロードマウント
      - ./frontend:/app
      # node_modulesをホストからマウント対象から除外（コンテナ内で依存関係を管理するため）
      - /app/node_modules
    # React開発サーバーを起動
    # ボリュームマウントでnode_modulesが空になるため、起動時に依存関係を再インストール
    command: sh -c "npm install && npm run dev"
    depends_on:
      - backend